from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
import os
import psycopg2
import logging
import json
from typing import List, Optional
from datetime import datetime

app = FastAPI()

# Configure logging
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

# CORS configuration
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Database connection
DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://itech_l1q2_user:AoqQkrtzrQW7WEDOJdh0C6hhlY5Xe3sv@dpg-cuvnsbggph6c73ev87g0-a/itech_l1q2")

def get_db():
    conn = psycopg2.connect(DATABASE_URL)
    return conn

# Pydantic models
class Product(BaseModel):
    name: str
    type: str
    buying_price: float
    selling_price: float

class Service(BaseModel):
    name: str
    description: str
    price: float

class Stock(BaseModel):
    product_name: str
    product_type: str
    quantity: int
    price_per_unit: float

class BankAccountUpdate(BaseModel):
    balance: float
    purpose: str

class Client(BaseModel):
    name: str
    email: str
    phone: str

class Asset(BaseModel):
    name: str
    type: str
    cost_price: float
    current_value: float
    quantity: int

class SaleItem(BaseModel):
    name: str
    quantity: int
    unit_price: float
    total: float

class Sale(BaseModel):
    client_name: str
    items: List[SaleItem]
    total_amount: float

# Initialize database tables
def init_db():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        # Drop and recreate tables to ensure the correct schema
        cursor.execute('DROP TABLE IF EXISTS bank_account;')
        cursor.execute('DROP TABLE IF EXISTS sales;')

        cursor.execute('''
            CREATE TABLE IF NOT EXISTS products (
                id SERIAL PRIMARY KEY,
                name TEXT NOT NULL,
                type TEXT NOT NULL,
                buying_price REAL NOT NULL,
                selling_price REAL NOT NULL
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS services (
                id SERIAL PRIMARY KEY,
                name TEXT NOT NULL,
                description TEXT NOT NULL,
                price REAL NOT NULL
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS stock (
                id SERIAL PRIMARY KEY,
                product_name TEXT NOT NULL,
                product_type TEXT NOT NULL,
                quantity INTEGER NOT NULL,
                price_per_unit REAL NOT NULL
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS bank_account (
                id SERIAL PRIMARY KEY,
                balance REAL NOT NULL
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS clients (
                id SERIAL PRIMARY KEY,
                name TEXT NOT NULL,
                email TEXT NOT NULL,
                phone TEXT NOT NULL
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS assets (
                id SERIAL PRIMARY KEY,
                name TEXT NOT NULL,
                type TEXT NOT NULL,
                cost_price REAL NOT NULL,
                current_value REAL NOT NULL,
                quantity INTEGER NOT NULL
            )
        ''')
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS sales (
                id SERIAL PRIMARY KEY,
                client_name TEXT NOT NULL,
                items JSONB NOT NULL,
                total_amount REAL NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        # Initialize the balance to 0 if the table is empty
        cursor.execute('SELECT COUNT(*) FROM bank_account')
        if cursor.fetchone()[0] == 0:
            cursor.execute('INSERT INTO bank_account (balance) VALUES (0)')
        conn.commit()
    except Exception as e:
        logger.error(f"Error initializing database: {e}")
        if conn:
            conn.rollback()
        raise
    finally:
        if conn:
            conn.close()

# Initialize database
init_db()

# Product endpoints
@app.post("/products/")
def add_product(product: Product):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        logger.debug(f"Adding product: {product}")
        cursor.execute('''
            INSERT INTO products (name, type, buying_price, selling_price)
            VALUES (%s, %s, %s, %s)
        ''', (
            product.name, product.type, product.buying_price, product.selling_price
        ))
        conn.commit()
        return {"message": "Product added successfully"}
    except Exception as e:
        logger.error(f"Error adding product: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail=f"Failed to add product: {str(e)}")
    finally:
        if conn:
            conn.close()

@app.get("/products/")
def get_products():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM products')
        products = cursor.fetchall()
        return {"products": [dict(zip([col[0] for col in cursor.description], row)) for row in products]}
    except Exception as e:
        logger.error(f"Error fetching products: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch products")
    finally:
        if conn:
            conn.close()

@app.delete("/products/{product_name}/{product_type}")
def delete_product(product_name: str, product_type: str):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM products WHERE name = %s AND type = %s', (product_name, product_type))
        product = cursor.fetchone()
        if not product:
            raise HTTPException(status_code=404, detail="Product not found")

        cursor.execute('DELETE FROM products WHERE name = %s AND type = %s', (product_name, product_type))
        conn.commit()
        return {"message": "Product deleted successfully"}
    except Exception as e:
        logger.error(f"Error deleting product: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to delete product")
    finally:
        if conn:
            conn.close()

# Stock endpoints
@app.get("/total_stock/")
def get_total_stock():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT SUM(quantity * price_per_unit) FROM stock')
        total_stock = cursor.fetchone()[0] or 0
        return {"total_stock": total_stock}
    except Exception as e:
        logger.error(f"Error calculating total stock: {e}")
        raise HTTPException(status_code=500, detail="Failed to calculate total stock")
    finally:
        if conn:
            conn.close()

@app.post("/stock/")
def add_stock(stock: Stock):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            INSERT INTO stock (product_name, product_type, quantity, price_per_unit)
            VALUES (%s, %s, %s, %s)
        ''', (
            stock.product_name, stock.product_type, stock.quantity, stock.price_per_unit
        ))
        conn.commit()
        return {"message": "Stock added successfully"}
    except Exception as e:
        logger.error(f"Error adding stock: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail=f"Failed to add stock: {str(e)}")
    finally:
        if conn:
            conn.close()

@app.get("/stock/")
def get_stock():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM stock')
        stock = cursor.fetchall()
        return {"stock": [dict(zip([col[0] for col in cursor.description], row)) for row in stock]}
    except Exception as e:
        logger.error(f"Error fetching stock: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch stock")
    finally:
        if conn:
            conn.close()

@app.delete("/stock/{product_name}/{product_type}")
def delete_stock(product_name: str, product_type: str):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM stock WHERE product_name = %s AND product_type = %s', (product_name, product_type))
        stock_item = cursor.fetchone()
        if not stock_item:
            raise HTTPException(status_code=404, detail="Stock item not found")

        cursor.execute('DELETE FROM stock WHERE product_name = %s AND product_type = %s', (product_name, product_type))
        conn.commit()
        return {"message": "Stock item deleted successfully"}
    except Exception as e:
        logger.error(f"Error deleting stock item: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to delete stock item")
    finally:
        if conn:
            conn.close()

# Service endpoints
@app.post("/services/")
def add_service(service: Service):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            INSERT INTO services (name, description, price)
            VALUES (%s, %s, %s)
        ''', (service.name, service.description, service.price))
        conn.commit()
        return {"message": "Service added successfully"}
    except Exception as e:
        logger.error(f"Error adding service: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to add service")
    finally:
        if conn:
            conn.close()

@app.get("/services/")
def get_services():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM services')
        services = cursor.fetchall()
        return {"services": [dict(zip([col[0] for col in cursor.description], row)) for row in services]}
    except Exception as e:
        logger.error(f"Error fetching services: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch services")
    finally:
        if conn:
            conn.close()

@app.delete("/services/{service_name}")
def delete_service(service_name: str):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM services WHERE name = %s', (service_name,))
        service = cursor.fetchone()
        if not service:
            raise HTTPException(status_code=404, detail="Service not found")

        cursor.execute('DELETE FROM services WHERE name = %s', (service_name,))
        conn.commit()
        return {"message": "Service deleted successfully"}
    except Exception as e:
        logger.error(f"Error deleting service: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to delete service")
    finally:
        if conn:
            conn.close()

# Bank Account endpoints
@app.get("/bank_account/")
def get_bank_account():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT balance FROM bank_account WHERE id = 1')
        balance = cursor.fetchone()[0]
        return {"balance": balance}
    except Exception as e:
        logger.error(f"Error fetching bank account balance: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch bank account balance")
    finally:
        if conn:
            conn.close()

@app.post("/bank_account/")
def update_bank_account(bank_account: BankAccountUpdate):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT balance FROM bank_account WHERE id = 1')
        current_balance = cursor.fetchone()[0]
        new_balance = current_balance + bank_account.balance
        cursor.execute('UPDATE bank_account SET balance = %s WHERE id = 1', (new_balance,))
        conn.commit()
        return {"message": "Bank account balance updated successfully"}
    except Exception as e:
        logger.error(f"Error updating bank account balance: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to update bank account balance")
    finally:
        if conn:
            conn.close()

# Client endpoints
@app.post("/clients/")
def add_client(client: Client):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            INSERT INTO clients (name, email, phone)
            VALUES (%s, %s, %s)
        ''', (client.name, client.email, client.phone))
        conn.commit()
        return {"message": "Client added successfully"}
    except Exception as e:
        logger.error(f"Error adding client: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to add client")
    finally:
        if conn:
            conn.close()

@app.get("/clients/")
def get_clients():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM clients')
        clients = cursor.fetchall()
        return {"clients": [dict(zip([col[0] for col in cursor.description], row)) for row in clients]}
    except Exception as e:
        logger.error(f"Error fetching clients: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch clients")
    finally:
        if conn:
            conn.close()

@app.delete("/clients/{client_name}")
def delete_client(client_name: str):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM clients WHERE name = %s', (client_name,))
        client = cursor.fetchone()
        if not client:
            raise HTTPException(status_code=404, detail="Client not found")

        cursor.execute('DELETE FROM clients WHERE name = %s', (client_name,))
        conn.commit()
        return {"message": "Client deleted successfully"}
    except Exception as e:
        logger.error(f"Error deleting client: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to delete client")
    finally:
        if conn:
            conn.close()

# Asset endpoints
@app.post("/assets/")
def add_asset(asset: Asset):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('''
            INSERT INTO assets (name, type, cost_price, current_value, quantity)
            VALUES (%s, %s, %s, %s, %s)
        ''', (asset.name, asset.type, asset.cost_price, asset.current_value, asset.quantity))
        conn.commit()
        return {"message": "Asset added successfully"}
    except Exception as e:
        logger.error(f"Error adding asset: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail=f"Failed to add asset: {str(e)}")
    finally:
        if conn:
            conn.close()

@app.get("/assets/")
def get_assets():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM assets')
        assets = cursor.fetchall()
        return {"assets": [dict(zip([col[0] for col in cursor.description], row)) for row in assets]}
    except Exception as e:
        logger.error(f"Error fetching assets: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch assets")
    finally:
        if conn:
            conn.close()

@app.delete("/assets/{asset_id}")
def delete_asset(asset_id: int):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM assets WHERE id = %s', (asset_id,))
        asset = cursor.fetchone()
        if not asset:
            raise HTTPException(status_code=404, detail="Asset not found")

        cursor.execute('DELETE FROM assets WHERE id = %s', (asset_id,))
        conn.commit()
        return {"message": "Asset deleted successfully"}
    except Exception as e:
        logger.error(f"Error deleting asset: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail="Failed to delete asset")
    finally:
        if conn:
            conn.close()

# Total Investment endpoint
@app.get("/total_investment/")
def get_total_investment():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()

        # Get total investment from assets
        cursor.execute('SELECT SUM(cost_price * quantity) FROM assets')
        total_assets = cursor.fetchone()[0] or 0

        # Get bank account balance
        cursor.execute('SELECT balance FROM bank_account WHERE id = 1')
        bank_balance = cursor.fetchone()[0] or 0

        # Get total amount in stock
        cursor.execute('SELECT SUM(quantity * price_per_unit) FROM stock')
        total_stock = cursor.fetchone()[0] or 0

        # Calculate total investment
        total_investment = total_assets + bank_balance + total_stock

        return {"total_investment": total_investment}
    except Exception as e:
        logger.error(f"Error calculating total investment: {e}")
        raise HTTPException(status_code=500, detail="Failed to calculate total investment")
    finally:
        if conn:
            conn.close()

# Sales endpoints
@app.post("/sales/")
def create_sale(sale: Sale):
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()

        # Insert the sale into the database
        cursor.execute('''
            INSERT INTO sales (client_name, items, total_amount)
            VALUES (%s, %s, %s)
        ''', (sale.client_name, json.dumps([item.dict() for item in sale.items]), sale.total_amount))

        # Update the bank account balance
        cursor.execute('SELECT balance FROM bank_account WHERE id = 1')
        current_balance = cursor.fetchone()[0]
        new_balance = current_balance + sale.total_amount
        cursor.execute('UPDATE bank_account SET balance = %s WHERE id = 1', (new_balance,))

        conn.commit()
        return {"message": "Sale created and bank account updated successfully"}
    except Exception as e:
        logger.error(f"Error creating sale: {e}")
        if conn:
            conn.rollback()
        raise HTTPException(status_code=500, detail=f"Failed to create sale: {str(e)}")
    finally:
        if conn:
            conn.close()

@app.get("/sales/")
def get_sales():
    conn = None
    try:
        conn = get_db()
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM sales ORDER BY created_at DESC')
        sales = cursor.fetchall()
        return {"sales": [dict(zip([col[0] for col in cursor.description], row)) for row in sales]}
    except Exception as e:
        logger.error(f"Error fetching sales: {e}")
        raise HTTPException(status_code=500, detail="Failed to fetch sales")
    finally:
        if conn:
            conn.close()

# Run the application
if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000),


    <!DOCTYPE html>
<html lang="en">
<head>
  <style>
    .overview {
      font-size: 34px;
      text-align: center;
      background-color: rgb(19, 19, 71);
      margin-bottom: 15px;
      color: white;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .dark .modal-content {
      background-color: #1f2937;
      color: white;
    }
    .sale-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .sale-table th, .sale-table td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    .dark .sale-table th, .dark .sale-table td {
      border-color: #374151;
    }
    .hidden {
      display: none;
    }
    .gray-button {
      background-color: #6b7280;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-align: center;
      display: inline-block;
      width: auto;
      margin: 5px;
      border: 1px solid black;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .gray-button:hover {
      background-color: #4b5563;
    }
    .close-button {
      background-color: #ef4444;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-align: center;
      display: inline-block;
      width: auto;
      margin: 5px;
      border: 1px solid black;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .close-button:hover {
      background-color: #dc2626;
    }
    .flex-end {
      display: flex;
      justify-content: flex-end;
    }
    .editable-unit-price {
      border: 1px solid #ddd;
      padding: 5px;
      border-radius: 4px;
      width: 80px;
    }
    .sales-history-modal {
      max-height: 80vh;
      overflow-y: auto;
    }
    .sales-history-modal table {
      width: 100%;
      border-collapse: collapse;
    }
    .sales-history-modal th, .sales-history-modal td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    .sales-history-modal th {
      background-color: #f3f4f6;
    }
    .dark .sales-history-modal th {
      background-color: #374151;
    }
  </style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Make a Sale - Ndyakurungi ITECH</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 dark:bg-gray-900">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow">
    <div class="container mx-auto p-4 flex items-center justify-between">
      <div class="flex items-center">
        <div class="text-4xl text-blue-600 dark:text-blue-400 mr-4">
          <img src="Itech-computers-logo1.webp" alt="Itech Computers Logo">
        </div>
        <div>
          <h1 class="text-2xl font-bold dark:text-white">NDYAKURUNGI ITECH COMPUTER SOLUTIONS</h1>
          <p class="text-sm text-gray-600 dark:text-gray-400">Name it, we will provide & deliver it</p>
        </div>
      </div>
      <!-- Dark/Light Mode Toggle -->
      <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
        <i id="themeIcon" class="fas fa-moon text-gray-800 dark:text-yellow-400"></i>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container mx-auto p-8">
    <!-- Make a Sale Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mb-8">
      <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-cash-register mr-2"></i>Make a Sale</h2>
      <!-- Buttons for Add Client and Choose Client -->
      <div class="flex justify-between mb-4">
        <button onclick="openChooseClientModal()" class="gray-button">
          <i class="fas fa-users mr-2"></i>Choose Client
        </button>
        <button onclick="openAddClientModal()" class="gray-button">
          <i class="fas fa-user-plus mr-2"></i>Add Client
        </button>
      </div>
      <!-- Sale Table -->
      <table class="sale-table">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="saleTableBody">
          <!-- Sale items will be dynamically added here -->
        </tbody>
      </table>
      <!-- Add Item and Select Service Buttons -->
      <div class="flex gap-2 mt-4">
        <button onclick="openAddItemModal()" class="gray-button">
          <i class="fas fa-plus mr-2"></i>Select Item
        </button>
        <button onclick="openSelectServiceModal()" class="gray-button">
          <i class="fas fa-cogs mr-2"></i>Select Service
        </button>
      </div>
      <!-- Total and Generate Receipt -->
      <div class="flex justify-end items-center mt-4">
        <p class="text-lg font-semibold dark:text-white mr-4">Total: <span id="saleTotal">0.00</span></p>
        <button onclick="generateReceipt()" class="gray-button">
          <i class="fas fa-receipt mr-2"></i>Generate Receipt
        </button>
      </div>
    </div>

    <!-- Sales History Section -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
      <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-history mr-2"></i>Sales History</h2>
      <!-- Search Sales History -->
      <input type="text" id="searchSales" placeholder="Search sales..." class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white">
      <!-- Sales History Table -->
      <table class="sale-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Client</th>
            <th>Items</th>
            <th>Total Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="salesHistoryBody">
          <!-- Sales history will be dynamically added here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Add Client Modal -->
  <div id="addClientModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-user-plus mr-2"></i>Add Client</h3>
      <form id="addClientForm">
        <input type="text" placeholder="Client Name" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Client Email" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Client Phone" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Client</button>
      </form>
      <button onclick="closeModal('addClientModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Choose Client Modal -->
  <div id="chooseClientModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-users mr-2"></i>Choose Client</h3>
      <button onclick="openAddClientModal()" class="gray-button mb-4">
        <i class="fas fa-user-plus mr-2"></i>Add New Client
      </button>
      <div id="clientList" class="mb-4">
        <!-- Clients will be dynamically added here -->
      </div>
      <button onclick="closeModal('chooseClientModal')" class="close-button">Close</button>
    </div>
  </div>

  <!-- Add Item Modal -->
  <div id="addItemModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Add Item</h3>
      <form id="addItemForm">
        <select id="itemSelect" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
          <option value="" disabled selected>Select Item</option>
          <!-- Items will be dynamically added here -->
        </select>
        <input type="number" placeholder="Quantity" id="itemQuantity" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Item</button>
      </form>
      <button onclick="closeModal('addItemModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Select Service Modal -->
  <div id="selectServiceModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-cogs mr-2"></i>Select Service</h3>
      <form id="selectServiceForm">
        <select id="serviceSelect" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
          <option value="" disabled selected>Select Service</option>
          <!-- Services will be dynamically added here -->
        </select>
        <input type="number" placeholder="Quantity" id="serviceQuantity" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Service</button>
      </form>
      <button onclick="closeModal('selectServiceModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    const { jsPDF } = window.jspdf;
    const backendUrl = 'https://man-m681.onrender.com'; // Replace with your Render backend URL
    let clients = [];
    let salesHistory = [];
    let currentSale = [];
    let selectedClient = null;
    let products = [];
    let stockItems = [];

    // Fetch Products and Stock from Backend
    async function fetchProducts() {
      const response = await fetch(`${backendUrl}/products/`);
      const data = await response.json();
      products = data.products;
      populateItemSelect();
    }

    async function fetchStock() {
      const response = await fetch(`${backendUrl}/stock/`);
      const data = await response.json();
      stockItems = data.stock;
    }

    // Populate Item Select Dropdown
    function populateItemSelect() {
      const itemSelect = document.getElementById('itemSelect');
      itemSelect.innerHTML = '<option value="" disabled selected>Select Item</option>' +
        products.map(product => `<option value="${product.name}" data-type="${product.type}">${product.name} (${product.type})</option>`).join('');
    }

    // Open Add Item Modal
    function openAddItemModal() {
      fetchProducts();
      document.getElementById('addItemModal').classList.remove('hidden');
    }

    // Add Item to Sale
    document.getElementById('addItemForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const itemName = document.getElementById('itemSelect').value;
      const quantity = parseFloat(document.getElementById('itemQuantity').value);

      // Fetch product details
      const product = products.find(p => p.name === itemName);
      if (!product) {
        alert('Product not found!');
        return;
      }

      // Fetch stock details
      const stockItem = stockItems.find(item => item.product_name === itemName);
      if (!stockItem || stockItem.quantity < quantity) {
        alert('Insufficient stock!');
        return;
      }

      const total = product.selling_price * quantity;
      currentSale.push({ itemName, quantity, unitPrice: product.selling_price, total });
      updateSaleTable();
      closeModal('addItemModal');
    });

    // Update Sale Table
    function updateSaleTable() {
      const saleTableBody = document.getElementById('saleTableBody');
      saleTableBody.innerHTML = currentSale.map((item, index) => `
        <tr>
          <td>${item.itemName}</td>
          <td>${item.quantity}</td>
          <td><input type="number" class="editable-unit-price" value="${item.unitPrice.toFixed(2)}" onchange="updateUnitPrice(${index}, this.value)"></td>
          <td>${item.total.toFixed(2)}</td>
          <td><button onclick="removeItem(${index})" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button></td>
        </tr>
      `).join('');

      // Update Total
      const total = currentSale.reduce((sum, item) => sum + item.total, 0);
      document.getElementById('saleTotal').textContent = total.toFixed(2);
    }

    // Update Unit Price
    function updateUnitPrice(index, newPrice) {
      const item = currentSale[index];
      item.unitPrice = parseFloat(newPrice);
      item.total = item.unitPrice * item.quantity;
      updateSaleTable();
    }

    // Remove Item from Sale
    function removeItem(index) {
      currentSale.splice(index, 1);
      updateSaleTable();
    }

    // Open Add Client Modal
    function openAddClientModal() {
      document.getElementById('addClientModal').classList.remove('hidden');
    }

    // Add Client
    document.getElementById('addClientForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const clientName = document.querySelector('#addClientForm input[type="text"]').value;
      const clientEmail = document.querySelector('#addClientForm input[type="text"]').value;
      const clientPhone = document.querySelector('#addClientForm input[type="text"]').value;

      // Send data to the backend
      const response = await fetch(`${backendUrl}/clients/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: clientName,
          email: clientEmail,
          phone: clientPhone,
        }),
      });

      if (response.ok) {
        alert('Client added successfully!');
        e.target.reset();
        closeModal('addClientModal');
      } else {
        alert('Failed to add client.');
      }
    });

    // Open Choose Client Modal
    async function openChooseClientModal() {
      // Fetch clients from the backend
      const response = await fetch(`${backendUrl}/clients/`);
      const data = await response.json();
      clients = data.clients;

      // Populate the client list
      const clientList = document.getElementById('clientList');
      clientList.innerHTML = clients.map(client => `
        <div class="flex justify-between items-center p-2 border-b dark:border-gray-700">
          <span>${client.name}</span>
          <button onclick="selectClient('${client.name}')" class="gray-button">Select</button>
        </div>
      `).join('');

      // Show the modal
      document.getElementById('chooseClientModal').classList.remove('hidden');
    }

    // Select Client
    function selectClient(clientName) {
      selectedClient = clients.find(client => client.name === clientName);
      closeModal('chooseClientModal');
    }

    // Close Modal
    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    // Generate Receipt
    async function generateReceipt() {
      if (currentSale.length === 0) {
        alert('No items in the sale!');
        return;
      }

      if (!selectedClient) {
        alert('Please select a client before generating the receipt.');
        return;
      }

      const total = currentSale.reduce((sum, item) => sum + item.total, 0);

      // Prepare the sale data
      const saleData = {
        client_name: selectedClient.name,
        items: currentSale.map(item => ({
          name: item.itemName,
          quantity: item.quantity,
          unit_price: item.unitPrice,
          total: item.total,
        })),
        total_amount: total,
      };

      // Send the sale data to the backend
      try {
        const response = await fetch(`${backendUrl}/sales/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(saleData),
        });

        if (response.ok) {
          alert('Sale created and bank account updated successfully!');

          // Generate the receipt PDF
          const doc = new jsPDF();
          doc.text('Receipt', 10, 10);
          doc.text(`Client: ${selectedClient.name}`, 10, 20);
          doc.text('Items:', 10, 30);
          currentSale.forEach((item, index) => {
            doc.text(`${item.itemName} - ${item.quantity} x ${item.unitPrice.toFixed(2)} = ${item.total.toFixed(2)}`, 10, 40 + (index * 10));
          });
          doc.text(`Total: ${total.toFixed(2)}`, 10, 40 + (currentSale.length * 10));
          doc.save('receipt.pdf');

          // Clear the current sale
          currentSale = [];
          updateSaleTable();
          fetchSalesHistory(); // Refresh sales history
        } else {
          alert('Failed to create sale.');
        }
      } catch (error) {
        console.error('Error creating sale:', error);
        alert('Failed to create sale.');
      }
    }

    // Fetch Sales History
    async function fetchSalesHistory() {
      try {
        const response = await fetch(`${backendUrl}/sales/`);
        const data = await response.json();
        salesHistory = data.sales;
        updateSalesHistory();
      } catch (error) {
        console.error('Error fetching sales history:', error);
      }
    }

    // Update Sales History Table
    function updateSalesHistory() {
      const salesHistoryBody = document.getElementById('salesHistoryBody');
      salesHistoryBody.innerHTML = salesHistory.map(sale => `
        <tr>
          <td>${new Date(sale.created_at).toLocaleDateString()}</td>
          <td>${sale.client_name}</td>
          <td>
            <ul>
              ${sale.items.map(item => `
                <li>${item.name} - ${item.quantity} x ${item.unit_price.toFixed(2)} = ${item.total.toFixed(2)}</li>
              `).join('')}
            </ul>
          </td>
          <td>${sale.total_amount.toFixed(2)}</td>
          <td>
            <button onclick="editSale('${sale.id}')" class="text-blue-500 hover:text-blue-700"><i class="fas fa-edit"></i></button>
            <button onclick="deleteSale('${sale.id}')" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
      `).join('');
    }

    // Initialize
    fetchProducts();
    fetchStock();
    fetchSalesHistory();
  </script>
</body>
</html>

dashboard,
<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    /* Existing CSS styles */
    .overview {
      font-size: 34px;
      text-align: center;
      background-color: rgb(19, 19, 71);
      margin-bottom: 15px;
      color: white;
    }
    .product-item .product-type {
      margin: 0 10px;
      color: #666;
      font-style: italic;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .dark .modal-content {
      background-color: #1f2937;
      color: white;
    }
    .stock-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .stock-table th, .stock-table td {
      padding: 12px;
      border: 1px solid #e5e7eb;
      text-align: left;
    }
    .stock-table th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    .stock-table tr:hover {
      background-color: #f3f4f6;
    }
    .dark .stock-table th, .dark .stock-table td {
      border-color: #374151;
    }
    .dark .stock-table th {
      background-color: #1f2937;
      color: #f9fafb;
    }
    .dark .stock-table tr:hover {
      background-color: #374151;
    }
    .hidden {
      display: none;
    }
    .gray-button {
      background-color: #6b7280;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-align: center;
      display: inline-block;
      width: auto;
      margin: 5px;
      border: 1px solid black;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .gray-button:hover {
      background-color: #4b5563;
    }
    .close-button {
      background-color: #ef4444;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-align: center;
      display: inline-block;
      width: auto;
      margin: 5px;
      border: 1px solid black;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    .close-button:hover {
      background-color: #dc2626;
    }
    .product-card, .services-card, .make-sale-card, .finance-card {
      background-color: inherit;
      padding: 6px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .dark .product-card, .dark .services-card, .dark .make-sale-card, .dark .finance-card {
      background-color: inherit;
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .quick-actions .action-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #4b5563;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .quick-actions .action-item:hover {
      color: #1e40af;
    }
    .quick-actions .action-item .hover-text {
      display: none;
    }
    .quick-actions .action-item:hover .default-text {
      display: none;
    }
    .quick-actions .action-item:hover .hover-text {
      display: inline;
    }
    .finance-card {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      padding: 16px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .dark .finance-card {
      background-color: #1f2937;
    }
    .finance-item {
      text-align: center;
      flex: 1;
    }
    .finance-item .amount-box {
      background-color: #f3f4f6;
      padding: 8px;
      border-radius: 4px;
      margin-top: 8px;
    }
    .dark .finance-item .amount-box {
      background-color: #374151;
    }
    .product-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: #f3f4f6;
      border-radius: 4px;
      margin-bottom: 4px;
    }
    .dark .product-item {
      background-color: #374151;
    }
    .product-item .actions {
      display: flex;
      gap: 8px;
    }
    .product-item .actions i {
      cursor: pointer;
      font-size: 16px;
    }
    .product-item .actions i:hover {
      opacity: 0.8;
    }
    .actions i {
      transition: color 0.2s ease;
    }
    .actions i:hover {
      opacity: 0.8;
    }
  </style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ndyakurungi ITECH Management System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 dark:bg-gray-900">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow">
    <div class="container mx-auto p-4 flex items-center justify-between">
      <div class="flex items-center">
        <div class="text-4xl text-blue-600 dark:text-blue-400 mr-4">
          <img src="Itech-computers-logo1.webp" alt="Itech Computers Logo">
        </div>
        <div>
          <h1 class="text-2xl font-bold dark:text-white">NDYAKURUNGI ITECH COMPUTER SOLUTIONS</h1>
          <p class="text-sm text-gray-600 dark:text-gray-400">Name it, we will provide & deliver it</p>
        </div>
      </div>
      <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
        <i id="themeIcon" class="fas fa-moon text-gray-800 dark:text-yellow-400"></i>
      </button>
    </div>
  </header>

  <!-- Horizontal Quick Actions -->
  <div class="quick-actions">
    <div class="action-item">
      <i class="fas fa-bell"></i>
      <span class="default-text">Notifications</span>
      <span class="hover-text">Show Notifications</span>
    </div>
    <div class="action-item">
      <i class="fas fa-file-invoice"></i>
      <span class="default-text">Invoice</span>
      <span class="hover-text">Create Invoice</span>
    </div>
    <div class="action-item">
      <i class="fas fa-file-alt"></i>
      <span class="default-text">Quotation</span>
      <span class="hover-text">Create Quotation</span>
    </div>
    <div class="action-item">
      <i class="fas fa-hand-holding-usd"></i>
      <span class="default-text">Request Payment</span>
      <span class="hover-text">Request Payment</span>
    </div>
    <div class="action-item">
      <i class="fas fa-money-check-alt"></i>
      <span class="default-text">Make Payment</span>
      <span class="hover-text">Make Payment</span>
    </div>
    <div class="action-item">
      <i class="fas fa-money-check-alt"></i>
      <span class="default-text">Daily Expenses</span>
      <span class="hover-text">Daily Expenses</span>
    </div>
    <div class="action-item">
      <i class="fas fa-money-check-alt"></i>
      <a href="assets.html">Assets</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto p-8">
    <!-- Product and Services Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Finance Card -->
      <div class="finance-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white"><i class="fas fa-wallet mr-2"></i>Bank Account</h3>
          <div class="amount-box dark:text-white">0</div>
          <button onclick="openDepositModal()" class="gray-button">Deposit</button>
          <button onclick="openWithdrawModal()" class="gray-button">Withdraw</button>
        </div>
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white"><i class="fas fa-chart-line mr-2"></i>Total Investment</h3>
          <div class="amount-box dark:text-white">0</div>
        </div>
        <div class="finance-item">
          <h3 class="text-lg font-semibold dark:text-white"><i class="fas fa-boxes mr-2"></i>Amount in Stock</h3>
          <div class="amount-box dark:text-white">0</div>
        </div>
      </div>

      <!-- Make Sale Card -->
      <div class="make-sale-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-cash-register mr-2"></i>Make a Sale</h2>
        <a href="make-sale.html" class="gray-button">
          <i class="fas fa-cash-register mr-2"></i>Make a Sale
        </a>
      </div>

      <!-- Products Card -->
      <div class="product-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-box-open mr-2"></i>Products Inventory</h2>
        <button onclick="openAddProductModal()" class="gray-button">
          <i class="fas fa-plus mr-2"></i>Add Product
        </button>
        <div class="mt-4">
          <details class="bg-gray-100 dark:bg-gray-700 p-2 rounded">
            <summary class="cursor-pointer dark:text-white">View Products</summary>
            <div id="productList" class="mt-2 space-y-2">
              <!-- Products will be dynamically added here -->
            </div>
          </details>
        </div>
        <button onclick="openStockManagementModal()" class="gray-button mt-4">
          <i class="fas fa-boxes mr-2"></i>Manage Stock
        </button>
      </div>

      <!-- Services Card -->
      <div class="services-card bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
        <h2 class="text-xl font-semibold mb-4 dark:text-white"><i class="fas fa-cogs mr-2"></i>Services Inventory</h2>
        <button onclick="openAddServiceModal()" class="gray-button">
          <i class="fas fa-plus mr-2"></i>Add Service
        </button>
        <div class="mt-4">
          <details class="bg-gray-100 dark:bg-gray-700 p-2 rounded">
            <summary class="cursor-pointer dark:text-white">View Services</summary>
            <div id="serviceList" class="mt-2 space-y-2">
              <!-- Services will be dynamically added here -->
            </div>
          </details>
        </div>
        <button onclick="openServiceManagementModal()" class="gray-button mt-4">
          <i class="fas fa-cogs mr-2"></i>Manage Services
        </button>
      </div>
    </div>
    <h1 class="overview">Overview</h1>
    <!-- Six Cards Section -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <!-- Total Sales Card -->
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-lg shadow text-white">
        <h3 class="text-lg font-semibold"><i class="fas fa-chart-line mr-2"></i>Total Sales</h3>
        <p class="text-2xl font-bold">Ugx<span id="totalSales">0</span></p>
      </div>
      <!-- Gross Profit Card -->
      <div class="bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-lg shadow text-white">
        <h3 class="text-lg font-semibold"><i class="fas fa-coins mr-2"></i>Gross Profit</h3>
        <p class="text-2xl font-bold">Ugx<span id="grossProfit">0</span></p>
      </div>
      <!-- Total Expenses Card -->
      <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-6 rounded-lg shadow text-white">
        <h3 class="text-lg font-semibold"><i class="fas fa-money-bill-wave mr-2"></i>Total Expenses</h3>
        <p class="text-2xl font-bold">Ugx<span id="totalExpenses">0</span></p>
      </div>
      <!-- Debtors Balance Card -->
      <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 p-6 rounded-lg shadow text-white">
        <h3 class="text-lg font-semibold"><i class="fas fa-hand-holding-usd mr-2"></i>Debtors Balance</h3>
        <p class="text-2xl font-bold">Ugx<span id="debtorsBalance">0</span></p>
      </div>
      <!-- Net Profit Card -->
      <div class="bg-gradient-to-r from-pink-500 to-pink-600 p-6 rounded-lg shadow text-white">
        <h3 class="text-lg font-semibold"><i class="fas fa-chart-pie mr-2"></i>Net Profit</h3>
        <p class="text-2xl font-bold">Ugx<span id="netProfit">0</span></p>
      </div>
      <!-- Stock Balance Card -->
      <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 p-6 rounded-lg shadow text-white">
        <h3 class="text-lg font-semibold"><i class="fas fa-boxes mr-2"></i>Stock Balance</h3>
        <p class="text-2xl font-bold">Ugx<span id="stockBalance">0</span></p>
      </div>
    </div>

    <!-- Bar Graph for Sales Analysis -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mb-8">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-chart-bar mr-2"></i>Sales Analysis (Last 6 Months)</h3>
      <canvas id="salesBarChart"></canvas>
    </div>

    <!-- Recent Transactions -->
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-receipt mr-2"></i>Last 3 Transactions</h3>
      <ul id="recentTransactions" class="space-y-2">
        <!-- Transactions will be dynamically added here -->
      </ul>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div id="addProductModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Product inventory</h3>
      <form id="addProductForm">
        <input type="text" placeholder="Product Name" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Product Type" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Buying Price" id="buyingPriceInput" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Selling Price" id="sellingPriceInput" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required readonly>
        <button type="submit" class="gray-button">Add Product</button>
      </form>
      <button onclick="closeModal('addProductModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Stock Management Modal -->
  <div id="stockManagementModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-boxes mr-2"></i>Manage Stock</h3>
      <table class="stock-table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Available Quantity</th>
            <th>Total Invested</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="stockTableBody">
          <!-- Stock items will be dynamically added here -->
        </tbody>
      </table>
      <button onclick="openAddStockModal()" class="gray-button mt-4">
        <i class="fas fa-plus mr-2"></i>Add New Quantity
      </button>
      <button onclick="closeModal('stockManagementModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Add Stock Modal -->
  <div id="addStockModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Add New Quantity</h3>
      <form id="addStockForm">
        <select id="stockItemSelect" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
          <option value="" disabled selected>Select Product</option>
          <!-- Product options will be dynamically added here -->
        </select>
        <input type="number" id="defaultUnitPriceInput" placeholder="Default Unit Price" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required readonly>
        <input type="number" placeholder="Quantity" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Price per Unit" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Quantity</button>
      </form>
      <button onclick="closeModal('addStockModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Product Details Modal -->
  <div id="productDetailsModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 id="productDetailsTitle" class="text-lg font-semibold mb-4 dark:text-white"></h3>
      <table class="stock-table">
        <tr>
          <th class="p-2">Product Type</th>
          <td id="productType" class="p-2"></td>
        </tr>
        <tr>
          <th class="p-2">Buying Price</th>
          <td id="buyingPrice" class="p-2"></td>
        </tr>
        <tr>
          <th class="p-2">Selling Price</th>
          <td id="sellingPrice" class="p-2"></td>
        </tr>
        <tr>
          <th class="p-2">Markup Profit (10%)</th>
          <td id="markupProfit" class="p-2"></td>
        </tr>
      </table>
      <button onclick="closeModal('productDetailsModal')" class="close-button mt-4">Close</button>
    </div>
  </div>

  <!-- Add Service Modal -->
  <div id="addServiceModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Add Service</h3>
      <form id="addServiceForm">
        <input type="text" placeholder="Service Name" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Service Description" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="number" placeholder="Service Price" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Add Service</button>
      </form>
      <button onclick="closeModal('addServiceModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Service Management Modal -->
  <div id="serviceManagementModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-cogs mr-2"></i>Manage Services</h3>
      <table class="stock-table">
        <thead>
          <tr>
            <th>Service Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="serviceTableBody">
          <!-- Services will be dynamically added here -->
        </tbody>
      </table>
      <button onclick="closeModal('serviceManagementModal')" class="close-button mt-2">Close</button>
    </div>
  </div>
<!-- Deposit Modal -->
  <div id="depositModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-plus mr-2"></i>Deposit</h3>
      <form id="depositForm">
        <input type="number" placeholder="Amount" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Purpose" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Deposit</button>
      </form>
      <button onclick="closeModal('depositModal')" class="close-button mt-2">Close</button>
    </div>
  </div>

  <!-- Withdraw Modal -->
  <div id="withdrawModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 class="text-lg font-semibold mb-4 dark:text-white"><i class="fas fa-minus mr-2"></i>Withdraw</h3>
      <form id="withdrawForm">
        <input type="number" placeholder="Amount" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <input type="text" placeholder="Purpose" class="w-full p-2 border rounded mb-4 dark:bg-gray-700 dark:text-white" required>
        <button type="submit" class="gray-button">Withdraw</button>
      </form>
      <button onclick="closeModal('withdrawModal')" class="close-button mt-2">Close</button>
    </div>
  </div>
  <!-- JavaScript -->
  <script>
    const backendUrl = 'https://man-m681.onrender.com'; // Replace with your Render backend URL

    // Dark/Light Mode Toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    themeToggle.addEventListener('click', () => {
      const htmlElement = document.documentElement;
      htmlElement.classList.toggle('dark');
      
      if (htmlElement.classList.contains('dark')) {
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
      } else {
        themeIcon.classList.remove('fa-sun');
        themeIcon.classList.add('fa-moon');
      }
    });
    // Open Deposit Modal
    function openDepositModal() {
      document.getElementById('depositModal').classList.remove('hidden');
    }

    // Open Withdraw Modal
    function openWithdrawModal() {
      document.getElementById('withdrawModal').classList.remove('hidden');
    }
    // Deposit Form Submission
    document.getElementById('depositForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const amount = parseFloat(e.target[0].value);
      const purpose = e.target[1].value;

      const response = await fetch(`${backendUrl}/bank_account/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          balance: amount,
          purpose: purpose
        })
      });

      if (response.ok) {
        alert('Deposit successful!');
        e.target.reset();
        closeModal('depositModal');
        fetchBankAccountBalance();
      } else {
        alert('Failed to deposit');
      }
    });

    // Withdraw Form Submission
    document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const amount = parseFloat(e.target[0].value);
      const purpose = e.target[1].value;

      const response = await fetch(`${backendUrl}/bank_account/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          balance: -amount,
          purpose: purpose
        })
      });

      if (response.ok) {
        alert('Withdrawal successful!');
        e.target.reset();
        closeModal('withdrawModal');
        fetchBankAccountBalance();
      } else {
        alert('Failed to withdraw');
      }
    });

    // Initialize
    fetchBankAccountBalance();


    // Fetch and display bank account balance
    async function fetchBankAccountBalance() {
      const response = await fetch(`${backendUrl}/bank_account/`);
      const data = await response.json();
      document.querySelector('.finance-item .amount-box').textContent = `UGX ${data.balance.toLocaleString()}`;
    }

    // Initialize
    fetchBankAccountBalance();

    // Open Add Product Modal
    function openAddProductModal() {
      document.getElementById('addProductModal').classList.remove('hidden');
    }

    // Open Stock Management Modal
    function openStockManagementModal() {
      document.getElementById('stockManagementModal').classList.remove('hidden');
      fetchStock();
    }

    // Open Add Stock Modal
    function openAddStockModal() {
    fetchProducts().then(products => {
        const stockItemSelect = document.getElementById('stockItemSelect');
        stockItemSelect.innerHTML = '<option value="" disabled selected>Select Product</option>' +
            products.map(product => `<option value="${product.name}" data-buying-price="${product.buying_price}" data-product-type="${product.type}">${product.name} (${product.type})</option>`).join('');
    });
    document.getElementById('addStockModal').classList.remove('hidden');
}

    // Populate Default Unit Price when Product is selected
    document.getElementById('stockItemSelect').addEventListener('change', (e) => {
      const selectedProduct = e.target.options[e.target.selectedIndex];
      const buyingPrice = selectedProduct.getAttribute('data-buying-price');
      document.getElementById('defaultUnitPriceInput').value = buyingPrice || '';
    });

    // Open Add Service Modal
    function openAddServiceModal() {
      document.getElementById('addServiceModal').classList.remove('hidden');
    }

    // Open Service Management Modal
    function openServiceManagementModal() {
      document.getElementById('serviceManagementModal').classList.remove('hidden');
      fetchServices();
    }

    // Close Modals
    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    // Add Product
    document.getElementById('addProductForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const productName = e.target[0].value;
      const productType = e.target[1].value;
      const buyingPrice = parseFloat(e.target[2].value);
      const sellingPrice = parseFloat(e.target[3].value);

      const response = await fetch(`${backendUrl}/products/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: productName,
          type: productType,
          buying_price: buyingPrice,
          selling_price: sellingPrice
        })
      });

      if (response.ok) {
        alert('Product added successfully!');
        e.target.reset();
        closeModal('addProductModal');
        fetchProducts();
      } else {
        alert('Failed to add product');
      }
    });

    // Add Stock
// Example: Update total investment after adding stock
document.getElementById('addStockForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const productName = document.getElementById('stockItemSelect').value;
  const selectedProduct = document.getElementById('stockItemSelect').options[document.getElementById('stockItemSelect').selectedIndex];
  const productType = selectedProduct.getAttribute('data-product-type');
  const quantity = parseFloat(e.target[2].value);
  const pricePerUnit = parseFloat(e.target[3].value);

  const response = await fetch(`${backendUrl}/stock/`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      product_name: productName,
      product_type: productType,
      quantity: quantity,
      price_per_unit: pricePerUnit
    })
  });

  if (response.ok) {
    alert('Stock added successfully!');
    e.target.reset();
    closeModal('addStockModal');
    fetchStock();
    updateTotalInvested(); // Update the total investment
  } else {
    alert('Failed to add stock');
  }
});
// Function to update the total invested amount in the finance card
async function updateTotalInvested() {
    const response = await fetch(`${backendUrl}/stock/`);
    const data = await response.json();
    let totalInvested = 0;

    data.stock.forEach(item => {
        totalInvested += item.quantity * item.price_per_unit;
    });

    document.querySelector('.finance-item:nth-child(3) .amount-box').textContent = `UGX ${totalInvested.toLocaleString()}`;
}


// Initialize
fetchProducts();
fetchStock();
fetchServices();
updateTotalInvested();   

    // Add Service
    document.getElementById('addServiceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const serviceName = e.target[0].value;
      const serviceDescription = e.target[1].value;
      const servicePrice = parseFloat(e.target[2].value);

      const response = await fetch(`${backendUrl}/services/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name: serviceName,
          description: serviceDescription,
          price: servicePrice
        })
      });

      if (response.ok) {
        alert('Service added successfully!');
        e.target.reset();
        closeModal('addServiceModal');
        fetchServices();
      } else {
        alert('Failed to add service');
      }
    });

    // Fetch Products
    async function fetchProducts() {
      const response = await fetch(`${backendUrl}/products/`);
      const data = await response.json();
      const productList = document.getElementById('productList');
      productList.innerHTML = data.products.map(product => `
        <div class="product-item">
          <span>${product.name} (${product.type})</span>
          <div class="actions">
            <i class="fas fa-trash text-red-500" onclick="deleteProduct('${product.name}', '${product.type}')"></i>
            <i class="fas fa-edit text-blue-500" onclick="editProduct('${product.name}', '${product.type}', ${product.buying_price}, ${product.selling_price})"></i>
            <i class="fas fa-eye text-green-500" onclick="showProductDetails('${product.name}', '${product.type}', ${product.buying_price}, ${product.selling_price})"></i>
          </div>
        </div>
      `).join('');
      return data.products;
    }

    // Fetch Stock
async function fetchStock() {
    const response = await fetch(`${backendUrl}/stock/`);
    const data = await response.json();
    const stockTableBody = document.getElementById('stockTableBody');
    stockTableBody.innerHTML = data.stock.map(item => `
        <tr>
            <td>${item.product_name}</td>
            <td>${item.quantity}</td>
            <td>UGX ${(item.price_per_unit * item.quantity).toLocaleString()}</td>
            <td class="actions">
                <i class="fas fa-trash text-red-500 hover:text-red-700 cursor-pointer" onclick="deleteStockItem('${item.product_name}', '${item.product_type}')"></i>
                <i class="fas fa-edit text-blue-500 hover:text-blue-700 cursor-pointer ml-2" onclick="editStockItem('${item.product_name}', '${item.product_type}', ${item.quantity}, ${item.price_per_unit})"></i>
                <i class="fas fa-eye text-green-500 hover:text-green-700 cursor-pointer ml-2" onclick="viewStockItem('${item.product_name}', '${item.product_type}', ${item.quantity}, ${item.price_per_unit})"></i>
            </td>
        </tr>
    `).join('');

    updateTotalInvested(); // Update the total invested amount in the finance card
}


    // Fetch Services
    async function fetchServices() {
      const response = await fetch(`${backendUrl}/services/`);
      const data = await response.json();
      const serviceList = document.getElementById('serviceList');
      const serviceTableBody = document.getElementById('serviceTableBody');

      serviceList.innerHTML = data.services.map(service => `
        <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded dark:text-white">
          <span>${service.name}</span>
          <div class="actions">
            <i class="fas fa-trash text-red-500" onclick="deleteService('${service.name}')"></i>
            <i class="fas fa-edit text-blue-500" onclick="editService('${service.name}', '${service.description}', ${service.price})"></i>
            <i class="fas fa-eye text-green-500" onclick="viewService('${service.name}', '${service.description}', ${service.price})"></i>
          </div>
        </div>
      `).join('');

      serviceTableBody.innerHTML = data.services.map(service => `
        <tr>
          <td>${service.name}</td>
          <td>${service.description}</td>
          <td>${service.price}</td>
          <td class="actions">
            <i class="fas fa-trash text-red-500 hover:text-red-700 cursor-pointer" onclick="deleteService('${service.name}')"></i>
            <i class="fas fa-edit text-blue-500 hover:text-blue-700 cursor-pointer ml-2" onclick="editService('${service.name}', '${service.description}', ${service.price})"></i>
            <i class="fas fa-eye text-green-500 hover:text-green-700 cursor-pointer ml-2" onclick="viewService('${service.name}', '${service.description}', ${service.price})"></i>
          </td>
        </tr>
      `).join('');
    }

    // Delete Product
    async function deleteProduct(productName, productType) {
      if (confirm(`Are you sure you want to delete ${productName} (${productType})?`)) {
        const response = await fetch(`${backendUrl}/products/${productName}/${productType}`, {
          method: 'DELETE',
        });

        if (response.ok) {
          alert('Product deleted successfully!');
          fetchProducts(); // Refresh the product list
        } else {
          alert('Failed to delete product');
        }
      }
    }

    // Delete Stock Item
    async function deleteStockItem(productName, productType) {
      if (confirm(`Are you sure you want to delete ${productName} (${productType})?`)) {
        const response = await fetch(`${backendUrl}/stock/${productName}/${productType}`, {
          method: 'DELETE',
        });

        if (response.ok) {
          alert(`${productName} (${productType}) deleted successfully!`);
          fetchStock(); // Refresh the stock table
        } else {
          alert('Failed to delete stock item');
        }
      }
    }

    // Delete Service
    async function deleteService(serviceName) {
      if (confirm(`Are you sure you want to delete ${serviceName}?`)) {
        const response = await fetch(`${backendUrl}/services/${serviceName}`, {
          method: 'DELETE',
        });

        if (response.ok) {
          alert('Service deleted successfully!');
          fetchServices(); // Refresh the services list
        } else {
          alert('Failed to delete service');
        }
      }
    }

    // Edit Product
    function editProduct(name, type, buyingPrice, sellingPrice) {
      document.getElementById('addProductModal').classList.remove('hidden');
      const form = document.getElementById('addProductForm');
      form[0].value = name;
      form[1].value = type;
      form[2].value = buyingPrice;
      form[3].value = sellingPrice;

      form.onsubmit = async (e) => {
        e.preventDefault();
        const productName = e.target[0].value;
        const productType = e.target[1].value;
        const buyingPrice = parseFloat(e.target[2].value);
        const sellingPrice = parseFloat(e.target[3].value);

        const response = await fetch(`${backendUrl}/products/${name}/${type}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: productName,
            type: productType,
            buying_price: buyingPrice,
            selling_price: sellingPrice
          })
        });

        if (response.ok) {
          alert('Product updated successfully!');
          e.target.reset();
          closeModal('addProductModal');
          fetchProducts();
        } else {
          alert('Failed to update product');
        }
      };
    }

    // Edit Stock Item
    function editStockItem(productName, productType, quantity, pricePerUnit) {
      openAddStockModal();

      const stockItemSelect = document.getElementById('stockItemSelect');
      stockItemSelect.value = productName;
      document.getElementById('defaultUnitPriceInput').value = pricePerUnit;
      document.getElementById('addStockForm').querySelector('input[type="number"]').value = quantity;
      document.getElementById('addStockForm').querySelectorAll('input[type="number"]')[1].value = pricePerUnit;

      const form = document.getElementById('addStockForm');
      form.onsubmit = async (e) => {
        e.preventDefault();
        const updatedQuantity = parseFloat(e.target[2].value);
        const updatedPricePerUnit = parseFloat(e.target[3].value);

        const response = await fetch(`${backendUrl}/stock/${productName}/${productType}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            quantity: updatedQuantity,
            price_per_unit: updatedPricePerUnit,
          }),
        });

        if (response.ok) {
          alert(`${productName} (${productType}) updated successfully!`);
          closeModal('addStockModal');
          fetchStock();
        } else {
          alert('Failed to update stock item');
        }
      };
    }

    // Edit Service
    function editService(name, description, price) {
      document.getElementById('addServiceModal').classList.remove('hidden');
      const form = document.getElementById('addServiceForm');
      form[0].value = name;
      form[1].value = description;
      form[2].value = price;

      form.onsubmit = async (e) => {
        e.preventDefault();
        const serviceName = e.target[0].value;
        const serviceDescription = e.target[1].value;
        const servicePrice = parseFloat(e.target[2].value);

        const response = await fetch(`${backendUrl}/services/${name}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name: serviceName,
            description: serviceDescription,
            price: servicePrice
          })
        });

        if (response.ok) {
          alert('Service updated successfully!');
          e.target.reset();
          closeModal('addServiceModal');
          fetchServices();
        } else {
          alert('Failed to update service');
        }
      };
    }

    // View Stock Item Details
    function viewStockItem(productName, productType, quantity, pricePerUnit) {
      alert(`
        Product Name: ${productName}
        Product Type: ${productType}
        Quantity: ${quantity}
        Price Per Unit: UGX ${pricePerUnit.toLocaleString()}
        Total Invested: UGX ${(quantity * pricePerUnit).toLocaleString()}
      `);
    }

    // View Service Details
    function viewService(name, description, price) {
      alert(`
        Service Name: ${name}
        Description: ${description}
        Price: UGX ${price.toLocaleString()}
      `);
    }

    // Show Product Details
    function showProductDetails(name, type, buyingPrice, sellingPrice) {
      document.getElementById('productDetailsTitle').textContent = name;
      document.getElementById('productType').textContent = type;
      document.getElementById('buyingPrice').textContent = buyingPrice;
      document.getElementById('sellingPrice').textContent = sellingPrice;
      document.getElementById('markupProfit').textContent = (sellingPrice - buyingPrice).toFixed(2);
      document.getElementById('productDetailsModal').classList.remove('hidden');
    }

    // Automatic Selling Price Calculation
    document.getElementById('buyingPriceInput').addEventListener('input', (e) => {
      const buyingPrice = parseFloat(e.target.value);
      if (!isNaN(buyingPrice)) {
        const sellingPrice = buyingPrice * 1.1; // 10% markup
        document.getElementById('sellingPriceInput').value = sellingPrice.toFixed(2);
      }
    });
    // On page load, fetch the total investment from the backend
document.addEventListener('DOMContentLoaded', async () => {
  const response = await fetch(`${backendUrl}/total_investment/`);
  const data = await response.json();
  const totalInvestment = data.total_investment || 0;

  const totalInvestmentElement = document.querySelector('.finance-item:nth-child(2) .amount-box');
  if (totalInvestmentElement) {
    totalInvestmentElement.textContent = `UGX ${totalInvestment.toLocaleString()}`;
  }
});
    document.addEventListener('DOMContentLoaded', () => {
    fetchBankAccountBalance();
    fetchTotalInvestment();
    fetchTotalStock(); // Add this line
});
    // Function to fetch and display the total amount in stock
async function fetchTotalStock() {
    const response = await fetch(`${backendUrl}/total_stock/`);
    const data = await response.json();
    const totalStock = data.total_stock || 0;

    const totalStockElement = document.querySelector('.finance-item:nth-child(3) .amount-box');
    if (totalStockElement) {
        totalStockElement.textContent = `UGX ${totalStock.toLocaleString()}`;
    }
}

// Initialize
fetchTotalStock();
    // Function to update the total invested amount in the finance card
async function updateTotalInvested() {
  const response = await fetch(`${backendUrl}/total_investment/`);
  const data = await response.json();
  const totalInvestment = data.total_investment || 0;

  const totalInvestmentElement = document.querySelector('.finance-item:nth-child(2) .amount-box');
  if (totalInvestmentElement) {
    totalInvestmentElement.textContent = `UGX ${totalInvestment.toLocaleString()}`;
  }
}
    // Initialize
    fetchProducts();
    fetchStock();
    fetchServices();
    fetchTotalInvestment();
    updateTotalInvested();
    
  </script>
</body>
</html>
